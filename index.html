<!DOCTYPE html>
<html>
<body>

<h1>音声認識</h1>

<select id="language">
  <option value="ja-JP">日本語</option>
  <option value="en-US">英語</option>
</select>

<button onclick="startDictation()">音声認識開始</button>
<button onclick="download()">ダウンロード</button>

<p id="status" style="color: red;">停止中</p>
<p id="transcript"></p>

<script>
function startDictation() {
    var language = document.getElementById('language').value;
    
    if (window.hasOwnProperty('webkitSpeechRecognition')) {

        var recognition = new webkitSpeechRecognition();

        recognition.continuous = false;
        recognition.interimResults = false;

        recognition.lang = language;
        recognition.start();
        
        document.getElementById('status').innerHTML = "起動中";
        document.getElementById('status').style.color = "green";

        recognition.onresult = function(e) {
            document.getElementById('transcript').innerHTML = e.results[0][0].transcript;
            recognition.stop();
            document.getElementById('status').innerHTML = "停止中";
            document.getElementById('status').style.color = "red";
        };

        recognition.onerror = function(e) {
            recognition.stop();
            document.getElementById('status').innerHTML = "停止中";
            document.getElementById('status').style.color = "red";
        }

    }
}

function download() {
    var text = document.getElementById('transcript').innerHTML;
    var element = document.createElement('a');
    element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
    element.setAttribute('download', 'output.txt');

    element.style.display = 'none';
    document.body.appendChild(element);

    element.click();

    document.body.removeChild(element);
}
</script>

</body>
</html>
